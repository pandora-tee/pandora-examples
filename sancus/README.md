# Sample Enclave Programs for the MSP430-Sancus TEE
[![Build Status](https://github.com/pandora-tee/pandora-examples/actions/workflows/sancus-cc.yml/badge.svg)](https://github.com/pandora-tee/pandora-examples/actions/workflows/sancus-cc.yml)
[![Validation Status](https://github.com/pandora-tee/pandora-examples/actions/workflows/sancus-ci.yml/badge.svg)](https://github.com/pandora-tee/pandora-examples/actions/workflows/sancus-ci.yml)

This directory contains the unit tests and evaluation case studies for the Pandora port to the [Sancus](https://downloads.distrinet-research.be/software/sancus/) research TEE for embedded 16-bit MSP430 microcontrollers. The hardware-abstraction layer and `SancusSDK` enclave loader have been integrated into the [upstream Pandora repository](https://github.com/pandora-tee/pandora).

More details can be found in Gert-Jan Goossens's [Msc thesis](https://downloads.distrinet-research.be/software/sancus/publications/goossens24thesis.pdf) and our [SysTEX'25 paper](https://vanbulck.net/files/systex25-pandora-sancus.pdf):

```bibtex
@inproceedings{goossens2025principled,
    title     = {Principled Symbolic Validation of Enclaves on Low-End Microcontrollers},
    author    = {Goossens, Gert-Jan and Van Bulck, Jo},
    booktitle = {8th Workshop on System Software for Trusted Execution {(SysTEX)}},
    publisher = {{IEEE}},
    month     = Jun,
    year      = 2025,
}
```

## Directory Structure

- **cfsan:** Hand-crafted assembly test enclaves for control-flow sanitization vulnerabilities (cf. paper §A.1)
- **ptrsan:** Hand-crafted assembly test enclaves for pointer sanitization vulnerabilities (cf. paper §A.2)
- **full_encl:** Sample enclaves written in C, including compiler-generated runtime entry/exit stubs (cf. paper §4.2)
- **t2w:** Reproduction of known vulnerabilities in Sancus applications and support libraries, discovered in the prior [Tale of 2 Worlds paper](https://vanbulck.net/files/ccs19-tale.pdf) (cf. paper §4.3)

## Reproduction

### Symbolic Validation

> :bulb: Symbolic validation of the test cases is ensured in the CI/CD pipeline (see [GitHub Actions output](https://github.com/pandora-tee/pandora-examples/actions/workflows/sancus-ci.yml)).

Support for symbolically validating Sancus enclaves has been fully upstreamed in the [Pandora repository](https://github.com/pandora-tee/pandora).

All directories contain, the source code (`main.c`, `foo.S`), compiled binary (`main.elf`), and relevant HTML reports generated by Pandora.

Proceed as follows to run Pandora on the example enclaves yourself:

```bash
# clone upstream repos
$ git clone https://github.com/pandora-tee/pandora && cd pandora
$ git clone https://github.com/angr/angr-platforms

# create Python virtual environment
$ sudo python3 -m venv venv && source ./venv/bin/activate

# install dependencies in virtual environment
(venv) $ python3 -m pip install -r requirements.txt && cd angr-platforms && python3 -m pip install . && cd ..

# now run pandora on a selected Sancus testcase
(venv) $ ./pandora.py run -n 30 -p ptr,cf --pandora-option PANDORA_EXPLORE_STACK_DEPTH=1500 /path/to/pandora-examples/sancus/testcase/main.elf
```

After Pandora successfully finished, you should see a summary in the console and human-readable HTML reports in the current directory.

**Note (dependencies).** The evaluation in the SysTEX'25 paper was tested to work with [pandora (commit 34ded2e)](https://github.com/pandora-tee/pandora/commit/34ded2e94d654116b0ce856fa82701d119352bab) and [angr-platforms (commit ee1b6d9)](https://github.com/angr/angr-platforms/commit/ee1b6d9d20f11b250580fa0d867d51957b8f4e53).

### Compiling and Running

> :warning: This step is _not_ needed to reproduce the results in the paper, as we provide precompiled binaries in this repository.

> :bulb: Compilation of the test cases is ensured in the CI/CD pipeline (see [GitHub Actions output](https://github.com/pandora-tee/pandora-examples/actions/workflows/sancus-cc.yml)).

If desired, the test cases can be compiled using the [Sancus compiler](https://github.com/sancus-tee/sancus-compiler/tree/master) and ran in the cycle-accurate, openMSP430-based [Sancus simulator](https://github.com/sancus-tee/sancus-core).

